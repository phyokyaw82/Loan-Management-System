{
    "sourceFile": "src/pages/Transactions/TransactionForm.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 19,
            "patches": [
                {
                    "date": 1770566229289,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770566943633,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,9 +73,9 @@\n                     >\r\n                         <option value=\"\">Select Loan</option>\r\n                         {loans.map((l) => (\r\n                             <option key={l._id} value={l._id}>\r\n-                                {l._id} - {l.borrower?.fullName || \"Unknown\"} - ${l.amount}\r\n+                                {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n                             </option>\r\n                         ))}\r\n                     </select>\r\n                 </div>\r\n"
                },
                {
                    "date": 1770567127641,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,8 +1,9 @@\n import { useState, useEffect } from \"react\";\r\n import { useNavigate, useParams } from \"react-router-dom\";\r\n import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n+import LoanHistory from \"../../components/LoanHistory\";\r\n \r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n@@ -141,8 +142,9 @@\n                         {id ? \"Update\" : \"Create\"}\r\n                     </button>\r\n                 </div>\r\n             </form>\r\n+            <LoanHistory loanId={transaction.loan} />\r\n         </div>\r\n     );\r\n };\r\n \r\n"
                },
                {
                    "date": 1770567238387,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,9 @@\n import { useState, useEffect } from \"react\";\r\n import { useNavigate, useParams } from \"react-router-dom\";\r\n import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n-import LoanHistory from \"../../components/LoanHistory\";\r\n+import LoanHistory from \"./LoanHistory\";\r\n \r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n"
                },
                {
                    "date": 1770567412358,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -58,94 +58,99 @@\n         }\r\n     };\r\n \r\n     return (\r\n-        <div className=\"max-w-md mx-auto\">\r\n-            <h1 className=\"text-2xl font-bold mb-4\">{id ? \"Edit\" : \"Add\"} Transaction</h1>\r\n-            <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n+        <>\r\n+            <div className=\"max-w-md mx-auto\">\r\n+                <h1 className=\"text-2xl font-bold mb-4\">{id ? \"Edit\" : \"Add\"} Transaction</h1>\r\n+                <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n \r\n-                {/* Loan */}\r\n-                <div className=\"flex flex-col\">\r\n-                    <label className=\"mb-1 font-medium\">Loan</label>\r\n-                    <select\r\n-                        name=\"loan\"\r\n-                        value={transaction.loan}\r\n-                        onChange={handleChange}\r\n-                        className=\"w-full border p-2 rounded\"\r\n-                    >\r\n-                        <option value=\"\">Select Loan</option>\r\n-                        {loans.map((l) => (\r\n-                            <option key={l._id} value={l._id}>\r\n-                                {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n-                            </option>\r\n-                        ))}\r\n-                    </select>\r\n-                </div>\r\n+                    {/* Loan */}\r\n+                    <div className=\"flex flex-col\">\r\n+                        <label className=\"mb-1 font-medium\">Loan</label>\r\n+                        <select\r\n+                            name=\"loan\"\r\n+                            value={transaction.loan}\r\n+                            onChange={handleChange}\r\n+                            className=\"w-full border p-2 rounded\"\r\n+                        >\r\n+                            <option value=\"\">Select Loan</option>\r\n+                            {loans.map((l) => (\r\n+                                <option key={l._id} value={l._id}>\r\n+                                    {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n+                                </option>\r\n+                            ))}\r\n+                        </select>\r\n+                    </div>\r\n \r\n-                {/* Transaction Type */}\r\n-                <div className=\"flex flex-col\">\r\n-                    <label className=\"mb-1 font-medium\">Type</label>\r\n-                    <select\r\n-                        name=\"type\"\r\n-                        value={transaction.type}\r\n-                        onChange={handleChange}\r\n-                        className=\"w-full border p-2 rounded\"\r\n-                    >\r\n-                        <option value=\"\">Select Type</option>\r\n-                        {typeOptions.map((t) => (\r\n-                            <option key={t} value={t}>{t}</option>\r\n-                        ))}\r\n-                    </select>\r\n-                </div>\r\n+                    {/* Transaction Type */}\r\n+                    <div className=\"flex flex-col\">\r\n+                        <label className=\"mb-1 font-medium\">Type</label>\r\n+                        <select\r\n+                            name=\"type\"\r\n+                            value={transaction.type}\r\n+                            onChange={handleChange}\r\n+                            className=\"w-full border p-2 rounded\"\r\n+                        >\r\n+                            <option value=\"\">Select Type</option>\r\n+                            {typeOptions.map((t) => (\r\n+                                <option key={t} value={t}>{t}</option>\r\n+                            ))}\r\n+                        </select>\r\n+                    </div>\r\n \r\n-                {/* Amount */}\r\n-                <div className=\"flex flex-col\">\r\n-                    <label className=\"mb-1 font-medium\">Amount</label>\r\n-                    <input\r\n-                        type=\"number\"\r\n-                        name=\"amount\"\r\n-                        value={transaction.amount}\r\n-                        onChange={handleChange}\r\n-                        className=\"w-full border p-2 rounded\"\r\n-                    />\r\n-                </div>\r\n+                    {/* Amount */}\r\n+                    <div className=\"flex flex-col\">\r\n+                        <label className=\"mb-1 font-medium\">Amount</label>\r\n+                        <input\r\n+                            type=\"number\"\r\n+                            name=\"amount\"\r\n+                            value={transaction.amount}\r\n+                            onChange={handleChange}\r\n+                            className=\"w-full border p-2 rounded\"\r\n+                        />\r\n+                    </div>\r\n \r\n-                {/* Description */}\r\n-                <div className=\"flex flex-col\">\r\n-                    <label className=\"mb-1 font-medium\">Description</label>\r\n-                    <input\r\n-                        type=\"text\"\r\n-                        name=\"description\"\r\n-                        value={transaction.description}\r\n-                        onChange={handleChange}\r\n-                        className=\"w-full border p-2 rounded\"\r\n-                    />\r\n-                </div>\r\n+                    {/* Description */}\r\n+                    <div className=\"flex flex-col\">\r\n+                        <label className=\"mb-1 font-medium\">Description</label>\r\n+                        <input\r\n+                            type=\"text\"\r\n+                            name=\"description\"\r\n+                            value={transaction.description}\r\n+                            onChange={handleChange}\r\n+                            className=\"w-full border p-2 rounded\"\r\n+                        />\r\n+                    </div>\r\n \r\n-                {/* Transaction Date */}\r\n-                <div className=\"flex flex-col\">\r\n-                    <label className=\"mb-1 font-medium\">Transaction Date</label>\r\n-                    <input\r\n-                        type=\"date\"\r\n-                        name=\"transactionDate\"\r\n-                        value={transaction.transactionDate}\r\n-                        onChange={handleChange}\r\n-                        className=\"w-full border p-2 rounded\"\r\n-                    />\r\n-                </div>\r\n+                    {/* Transaction Date */}\r\n+                    <div className=\"flex flex-col\">\r\n+                        <label className=\"mb-1 font-medium\">Transaction Date</label>\r\n+                        <input\r\n+                            type=\"date\"\r\n+                            name=\"transactionDate\"\r\n+                            value={transaction.transactionDate}\r\n+                            onChange={handleChange}\r\n+                            className=\"w-full border p-2 rounded\"\r\n+                        />\r\n+                    </div>\r\n \r\n-                {/* Submit Button */}\r\n-                <div className=\"flex justify-end\">\r\n-                    <button\r\n-                        type=\"submit\"\r\n-                        className=\"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600\"\r\n-                    >\r\n-                        {id ? \"Update\" : \"Create\"}\r\n-                    </button>\r\n-                </div>\r\n-            </form>\r\n-            <LoanHistory loanId={transaction.loan} />\r\n-        </div>\r\n+                    {/* Submit Button */}\r\n+                    <div className=\"flex justify-end\">\r\n+                        <button\r\n+                            type=\"submit\"\r\n+                            className=\"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600\"\r\n+                        >\r\n+                            {id ? \"Update\" : \"Create\"}\r\n+                        </button>\r\n+                    </div>\r\n+                </form>\r\n+\r\n+            </div>\r\n+            <div className=\"p-4\">\r\n+                <LoanHistory loanId={transaction.loan} />\r\n+            </div>\r\n+        </>\r\n     );\r\n };\r\n \r\n export default TransactionForm;\r\n"
                },
                {
                    "date": 1770567898165,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,9 +146,9 @@\n                 </form>\r\n \r\n             </div>\r\n             <div className=\"p-4\">\r\n-                <LoanHistory loanId={transaction.loan} />\r\n+                {transaction.loan && <LoanHistory loanId={transaction.loan._id} />}\r\n             </div>\r\n         </>\r\n     );\r\n };\r\n"
                },
                {
                    "date": 1770567934979,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,9 +146,10 @@\n                 </form>\r\n \r\n             </div>\r\n             <div className=\"p-4\">\r\n-                {transaction.loan && <LoanHistory loanId={transaction.loan._id} />}\r\n+                {transaction.loan}\r\n+                <LoanHistory loanId={transaction.loan} />\r\n             </div>\r\n         </>\r\n     );\r\n };\r\n"
                },
                {
                    "date": 1770568027931,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -146,9 +146,8 @@\n                 </form>\r\n \r\n             </div>\r\n             <div className=\"p-4\">\r\n-                {transaction.loan}\r\n                 <LoanHistory loanId={transaction.loan} />\r\n             </div>\r\n         </>\r\n     );\r\n"
                },
                {
                    "date": 1770576051637,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,8 +2,9 @@\n import { useNavigate, useParams } from \"react-router-dom\";\r\n import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n import LoanHistory from \"./LoanHistory\";\r\n+import PageToolbar from \"../../components/PageToolbar\";\r\n \r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n@@ -60,9 +61,9 @@\n \r\n     return (\r\n         <>\r\n             <div className=\"max-w-md mx-auto\">\r\n-                <h1 className=\"text-2xl font-bold mb-4\">{id ? \"Edit\" : \"Add\"} Transaction</h1>\r\n+                <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n                 <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n \r\n                     {/* Loan */}\r\n                     <div className=\"flex flex-col\">\r\n"
                },
                {
                    "date": 1770576708067,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,16 @@\n import { getLoans } from \"../../api/loanApi\";\r\n import LoanHistory from \"./LoanHistory\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n \r\n+// Optional: small reusable form row\r\n+const FormRow = ({ label, children }) => (\r\n+    <div className=\"flex flex-col\">\r\n+        <label className=\"mb-1 font-medium\">{label}</label>\r\n+        {children}\r\n+    </div>\r\n+);\r\n+\r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n         type: \"\",\r\n@@ -20,12 +28,10 @@\n \r\n     const typeOptions = [\"Repayment\", \"Late Fee\", \"Penalty\"];\r\n \r\n     useEffect(() => {\r\n-        // Fetch loans for dropdown\r\n         getLoans().then(setLoans);\r\n \r\n-        // If editing, fetch transaction by ID\r\n         if (id) {\r\n             getTransactionById(id).then((data) => {\r\n                 setTransaction({\r\n                     loan: data.loan?._id || \"\",\r\n@@ -62,13 +68,12 @@\n     return (\r\n         <>\r\n             <div className=\"max-w-md mx-auto\">\r\n                 <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n+\r\n                 <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n \r\n-                    {/* Loan */}\r\n-                    <div className=\"flex flex-col\">\r\n-                        <label className=\"mb-1 font-medium\">Loan</label>\r\n+                    <FormRow label=\"Loan\">\r\n                         <select\r\n                             name=\"loan\"\r\n                             value={transaction.loan}\r\n                             onChange={handleChange}\r\n@@ -80,13 +85,11 @@\n                                     {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n                                 </option>\r\n                             ))}\r\n                         </select>\r\n-                    </div>\r\n+                    </FormRow>\r\n \r\n-                    {/* Transaction Type */}\r\n-                    <div className=\"flex flex-col\">\r\n-                        <label className=\"mb-1 font-medium\">Type</label>\r\n+                    <FormRow label=\"Type\">\r\n                         <select\r\n                             name=\"type\"\r\n                             value={transaction.type}\r\n                             onChange={handleChange}\r\n@@ -96,47 +99,40 @@\n                             {typeOptions.map((t) => (\r\n                                 <option key={t} value={t}>{t}</option>\r\n                             ))}\r\n                         </select>\r\n-                    </div>\r\n+                    </FormRow>\r\n \r\n-                    {/* Amount */}\r\n-                    <div className=\"flex flex-col\">\r\n-                        <label className=\"mb-1 font-medium\">Amount</label>\r\n+                    <FormRow label=\"Amount\">\r\n                         <input\r\n                             type=\"number\"\r\n                             name=\"amount\"\r\n                             value={transaction.amount}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                         />\r\n-                    </div>\r\n+                    </FormRow>\r\n \r\n-                    {/* Description */}\r\n-                    <div className=\"flex flex-col\">\r\n-                        <label className=\"mb-1 font-medium\">Description</label>\r\n+                    <FormRow label=\"Description\">\r\n                         <input\r\n                             type=\"text\"\r\n                             name=\"description\"\r\n                             value={transaction.description}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                         />\r\n-                    </div>\r\n+                    </FormRow>\r\n \r\n-                    {/* Transaction Date */}\r\n-                    <div className=\"flex flex-col\">\r\n-                        <label className=\"mb-1 font-medium\">Transaction Date</label>\r\n+                    <FormRow label=\"Transaction Date\">\r\n                         <input\r\n                             type=\"date\"\r\n                             name=\"transactionDate\"\r\n                             value={transaction.transactionDate}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                         />\r\n-                    </div>\r\n+                    </FormRow>\r\n \r\n-                    {/* Submit Button */}\r\n                     <div className=\"flex justify-end\">\r\n                         <button\r\n                             type=\"submit\"\r\n                             className=\"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600\"\r\n@@ -144,10 +140,10 @@\n                             {id ? \"Update\" : \"Create\"}\r\n                         </button>\r\n                     </div>\r\n                 </form>\r\n+            </div>\r\n \r\n-            </div>\r\n             <div className=\"p-4\">\r\n                 <LoanHistory loanId={transaction.loan} />\r\n             </div>\r\n         </>\r\n"
                },
                {
                    "date": 1770577172672,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,17 +3,10 @@\n import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n import LoanHistory from \"./LoanHistory\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n+import FormRow from \"../../components/FormRow\"; // <-- import shared FormRow\r\n \r\n-// Optional: small reusable form row\r\n-const FormRow = ({ label, children }) => (\r\n-    <div className=\"flex flex-col\">\r\n-        <label className=\"mb-1 font-medium\">{label}</label>\r\n-        {children}\r\n-    </div>\r\n-);\r\n-\r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n         type: \"\",\r\n"
                },
                {
                    "date": 1770577730547,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -59,13 +59,11 @@\n     };\r\n \r\n     return (\r\n         <>\r\n+            <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n             <div className=\"max-w-md mx-auto\">\r\n-                <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n-\r\n                 <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n-\r\n                     <FormRow label=\"Loan\">\r\n                         <select\r\n                             name=\"loan\"\r\n                             value={transaction.loan}\r\n"
                },
                {
                    "date": 1770582005559,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n         type: \"\",\r\n-        amount: \"\",\r\n+        amount: 0,\r\n         description: \"\",\r\n         transactionDate: \"\"\r\n     });\r\n \r\n"
                },
                {
                    "date": 1770583918974,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,8 +68,9 @@\n                             name=\"loan\"\r\n                             value={transaction.loan}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n+                            required\r\n                         >\r\n                             <option value=\"\">Select Loan</option>\r\n                             {loans.map((l) => (\r\n                                 <option key={l._id} value={l._id}>\r\n@@ -84,8 +85,9 @@\n                             name=\"type\"\r\n                             value={transaction.type}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n+                            required\r\n                         >\r\n                             <option value=\"\">Select Type</option>\r\n                             {typeOptions.map((t) => (\r\n                                 <option key={t} value={t}>{t}</option>\r\n@@ -99,8 +101,9 @@\n                             name=\"amount\"\r\n                             value={transaction.amount}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n+                            required\r\n                         />\r\n                     </FormRow>\r\n \r\n                     <FormRow label=\"Description\">\r\n@@ -119,8 +122,9 @@\n                             name=\"transactionDate\"\r\n                             value={transaction.transactionDate}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n+                            required\r\n                         />\r\n                     </FormRow>\r\n \r\n                     <div className=\"flex justify-end\">\r\n"
                },
                {
                    "date": 1770584502468,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n import LoanHistory from \"./LoanHistory\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n-import FormRow from \"../../components/FormRow\"; // <-- import shared FormRow\r\n+import FormRow from \"../../components/FormRow\";\r\n \r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n@@ -20,32 +20,57 @@\n     const { id } = useParams();\r\n \r\n     const typeOptions = [\"Repayment\", \"Late Fee\", \"Penalty\"];\r\n \r\n+    // Fetch loans and transaction data if editing\r\n     useEffect(() => {\r\n-        getLoans().then(setLoans);\r\n+        const fetchData = async () => {\r\n+            const loanData = await getLoans();\r\n+            setLoans(loanData);\r\n \r\n-        if (id) {\r\n-            getTransactionById(id).then((data) => {\r\n+            if (id) {\r\n+                const txData = await getTransactionById(id);\r\n                 setTransaction({\r\n-                    loan: data.loan?._id || \"\",\r\n-                    type: data.type || \"\",\r\n-                    amount: data.amount || \"\",\r\n-                    description: data.description || \"\",\r\n-                    transactionDate: data.transactionDate ? data.transactionDate.slice(0, 10) : \"\"\r\n+                    loan: txData.loan?._id || \"\",\r\n+                    type: txData.type || \"\",\r\n+                    amount: txData.amount || 0,\r\n+                    description: txData.description || \"\",\r\n+                    transactionDate: txData.transactionDate ? txData.transactionDate.slice(0, 10) : \"\"\r\n                 });\r\n-            });\r\n-        }\r\n+            }\r\n+        };\r\n+\r\n+        fetchData();\r\n     }, [id]);\r\n \r\n-    const handleChange = (e) => setTransaction({ ...transaction, [e.target.name]: e.target.value });\r\n+    // Find selected loan object for balance display\r\n+    const selectedLoan = loans.find((l) => l._id === transaction.loan);\r\n+    const remainingBalance = selectedLoan?.balance || 0;\r\n \r\n+    // Handle input changes\r\n+    const handleChange = (e) => {\r\n+        const { name, value } = e.target;\r\n+        setTransaction({\r\n+            ...transaction,\r\n+            [name]: name === \"amount\" ? Number(value) : value\r\n+        });\r\n+    };\r\n+\r\n+    // Handle form submit\r\n     const handleSubmit = async (e) => {\r\n         e.preventDefault();\r\n \r\n+        const amount = Number(transaction.amount);\r\n+\r\n+        // Prevent repayment exceeding remaining balance\r\n+        if (transaction.type === \"Repayment\" && amount > remainingBalance) {\r\n+            alert(`Cannot pay more than remaining balance: ${remainingBalance}`);\r\n+            return;\r\n+        }\r\n+\r\n         const payload = {\r\n             ...transaction,\r\n-            amount: Number(transaction.amount),\r\n+            amount,\r\n             transactionDate: transaction.transactionDate ? new Date(transaction.transactionDate) : new Date()\r\n         };\r\n \r\n         try {\r\n@@ -60,10 +85,13 @@\n \r\n     return (\r\n         <>\r\n             <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n+\r\n             <div className=\"max-w-md mx-auto\">\r\n                 <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n+\r\n+                    {/* Loan selection */}\r\n                     <FormRow label=\"Loan\">\r\n                         <select\r\n                             name=\"loan\"\r\n                             value={transaction.loan}\r\n@@ -73,14 +101,20 @@\n                         >\r\n                             <option value=\"\">Select Loan</option>\r\n                             {loans.map((l) => (\r\n                                 <option key={l._id} value={l._id}>\r\n-                                    {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n+                                    {l.borrower?.fullName ? `${l.borrower.fullName} - ${l.amount}` : `Unknown - ${l.amount}`}\r\n                                 </option>\r\n                             ))}\r\n                         </select>\r\n+                        {selectedLoan && (\r\n+                            <p className=\"text-sm text-gray-600 mt-1\">\r\n+                                Remaining Balance: {remainingBalance}\r\n+                            </p>\r\n+                        )}\r\n                     </FormRow>\r\n \r\n+                    {/* Transaction Type */}\r\n                     <FormRow label=\"Type\">\r\n                         <select\r\n                             name=\"type\"\r\n                             value={transaction.type}\r\n@@ -94,19 +128,22 @@\n                             ))}\r\n                         </select>\r\n                     </FormRow>\r\n \r\n+                    {/* Amount */}\r\n                     <FormRow label=\"Amount\">\r\n                         <input\r\n                             type=\"number\"\r\n                             name=\"amount\"\r\n                             value={transaction.amount}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                             required\r\n+                            min=\"0\"\r\n                         />\r\n                     </FormRow>\r\n \r\n+                    {/* Description */}\r\n                     <FormRow label=\"Description\">\r\n                         <input\r\n                             type=\"text\"\r\n                             name=\"description\"\r\n@@ -115,8 +152,9 @@\n                             className=\"w-full border p-2 rounded\"\r\n                         />\r\n                     </FormRow>\r\n \r\n+                    {/* Transaction Date */}\r\n                     <FormRow label=\"Transaction Date\">\r\n                         <input\r\n                             type=\"date\"\r\n                             name=\"transactionDate\"\r\n@@ -126,8 +164,9 @@\n                             required\r\n                         />\r\n                     </FormRow>\r\n \r\n+                    {/* Submit button */}\r\n                     <div className=\"flex justify-end\">\r\n                         <button\r\n                             type=\"submit\"\r\n                             className=\"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600\"\r\n@@ -137,8 +176,9 @@\n                     </div>\r\n                 </form>\r\n             </div>\r\n \r\n+            {/* Loan history */}\r\n             <div className=\"p-4\">\r\n                 <LoanHistory loanId={transaction.loan} />\r\n             </div>\r\n         </>\r\n"
                },
                {
                    "date": 1770584582919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n import LoanHistory from \"./LoanHistory\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n-import FormRow from \"../../components/FormRow\";\r\n+import FormRow from \"../../components/FormRow\"; // <-- import shared FormRow\r\n \r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n@@ -20,57 +20,32 @@\n     const { id } = useParams();\r\n \r\n     const typeOptions = [\"Repayment\", \"Late Fee\", \"Penalty\"];\r\n \r\n-    // Fetch loans and transaction data if editing\r\n     useEffect(() => {\r\n-        const fetchData = async () => {\r\n-            const loanData = await getLoans();\r\n-            setLoans(loanData);\r\n+        getLoans().then(setLoans);\r\n \r\n-            if (id) {\r\n-                const txData = await getTransactionById(id);\r\n+        if (id) {\r\n+            getTransactionById(id).then((data) => {\r\n                 setTransaction({\r\n-                    loan: txData.loan?._id || \"\",\r\n-                    type: txData.type || \"\",\r\n-                    amount: txData.amount || 0,\r\n-                    description: txData.description || \"\",\r\n-                    transactionDate: txData.transactionDate ? txData.transactionDate.slice(0, 10) : \"\"\r\n+                    loan: data.loan?._id || \"\",\r\n+                    type: data.type || \"\",\r\n+                    amount: data.amount || \"\",\r\n+                    description: data.description || \"\",\r\n+                    transactionDate: data.transactionDate ? data.transactionDate.slice(0, 10) : \"\"\r\n                 });\r\n-            }\r\n-        };\r\n-\r\n-        fetchData();\r\n+            });\r\n+        }\r\n     }, [id]);\r\n \r\n-    // Find selected loan object for balance display\r\n-    const selectedLoan = loans.find((l) => l._id === transaction.loan);\r\n-    const remainingBalance = selectedLoan?.balance || 0;\r\n+    const handleChange = (e) => setTransaction({ ...transaction, [e.target.name]: e.target.value });\r\n \r\n-    // Handle input changes\r\n-    const handleChange = (e) => {\r\n-        const { name, value } = e.target;\r\n-        setTransaction({\r\n-            ...transaction,\r\n-            [name]: name === \"amount\" ? Number(value) : value\r\n-        });\r\n-    };\r\n-\r\n-    // Handle form submit\r\n     const handleSubmit = async (e) => {\r\n         e.preventDefault();\r\n \r\n-        const amount = Number(transaction.amount);\r\n-\r\n-        // Prevent repayment exceeding remaining balance\r\n-        if (transaction.type === \"Repayment\" && amount > remainingBalance) {\r\n-            alert(`Cannot pay more than remaining balance: ${remainingBalance}`);\r\n-            return;\r\n-        }\r\n-\r\n         const payload = {\r\n             ...transaction,\r\n-            amount,\r\n+            amount: Number(transaction.amount),\r\n             transactionDate: transaction.transactionDate ? new Date(transaction.transactionDate) : new Date()\r\n         };\r\n \r\n         try {\r\n@@ -85,13 +60,10 @@\n \r\n     return (\r\n         <>\r\n             <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n-\r\n             <div className=\"max-w-md mx-auto\">\r\n                 <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n-\r\n-                    {/* Loan selection */}\r\n                     <FormRow label=\"Loan\">\r\n                         <select\r\n                             name=\"loan\"\r\n                             value={transaction.loan}\r\n@@ -101,20 +73,14 @@\n                         >\r\n                             <option value=\"\">Select Loan</option>\r\n                             {loans.map((l) => (\r\n                                 <option key={l._id} value={l._id}>\r\n-                                    {l.borrower?.fullName ? `${l.borrower.fullName} - ${l.amount}` : `Unknown - ${l.amount}`}\r\n+                                    {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n                                 </option>\r\n                             ))}\r\n                         </select>\r\n-                        {selectedLoan && (\r\n-                            <p className=\"text-sm text-gray-600 mt-1\">\r\n-                                Remaining Balance: {remainingBalance}\r\n-                            </p>\r\n-                        )}\r\n                     </FormRow>\r\n \r\n-                    {/* Transaction Type */}\r\n                     <FormRow label=\"Type\">\r\n                         <select\r\n                             name=\"type\"\r\n                             value={transaction.type}\r\n@@ -128,22 +94,19 @@\n                             ))}\r\n                         </select>\r\n                     </FormRow>\r\n \r\n-                    {/* Amount */}\r\n                     <FormRow label=\"Amount\">\r\n                         <input\r\n                             type=\"number\"\r\n                             name=\"amount\"\r\n                             value={transaction.amount}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                             required\r\n-                            min=\"0\"\r\n                         />\r\n                     </FormRow>\r\n \r\n-                    {/* Description */}\r\n                     <FormRow label=\"Description\">\r\n                         <input\r\n                             type=\"text\"\r\n                             name=\"description\"\r\n@@ -152,9 +115,8 @@\n                             className=\"w-full border p-2 rounded\"\r\n                         />\r\n                     </FormRow>\r\n \r\n-                    {/* Transaction Date */}\r\n                     <FormRow label=\"Transaction Date\">\r\n                         <input\r\n                             type=\"date\"\r\n                             name=\"transactionDate\"\r\n@@ -164,9 +126,8 @@\n                             required\r\n                         />\r\n                     </FormRow>\r\n \r\n-                    {/* Submit button */}\r\n                     <div className=\"flex justify-end\">\r\n                         <button\r\n                             type=\"submit\"\r\n                             className=\"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600\"\r\n@@ -176,9 +137,8 @@\n                     </div>\r\n                 </form>\r\n             </div>\r\n \r\n-            {/* Loan history */}\r\n             <div className=\"p-4\">\r\n                 <LoanHistory loanId={transaction.loan} />\r\n             </div>\r\n         </>\r\n"
                },
                {
                    "date": 1770584827967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n import LoanHistory from \"./LoanHistory\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n-import FormRow from \"../../components/FormRow\"; // <-- import shared FormRow\r\n+import FormRow from \"../../components/FormRow\";\r\n \r\n const TransactionForm = () => {\r\n     const [transaction, setTransaction] = useState({\r\n         loan: \"\",\r\n@@ -21,31 +21,53 @@\n \r\n     const typeOptions = [\"Repayment\", \"Late Fee\", \"Penalty\"];\r\n \r\n     useEffect(() => {\r\n-        getLoans().then(setLoans);\r\n+        const fetchData = async () => {\r\n+            const loanData = await getLoans();\r\n+            setLoans(loanData);\r\n \r\n-        if (id) {\r\n-            getTransactionById(id).then((data) => {\r\n+            if (id) {\r\n+                const txData = await getTransactionById(id);\r\n                 setTransaction({\r\n-                    loan: data.loan?._id || \"\",\r\n-                    type: data.type || \"\",\r\n-                    amount: data.amount || \"\",\r\n-                    description: data.description || \"\",\r\n-                    transactionDate: data.transactionDate ? data.transactionDate.slice(0, 10) : \"\"\r\n+                    loan: txData.loan?._id || \"\",\r\n+                    type: txData.type || \"\",\r\n+                    amount: txData.amount || 0,\r\n+                    description: txData.description || \"\",\r\n+                    transactionDate: txData.transactionDate ? txData.transactionDate.slice(0, 10) : \"\"\r\n                 });\r\n-            });\r\n-        }\r\n+            }\r\n+        };\r\n+\r\n+        fetchData();\r\n     }, [id]);\r\n \r\n-    const handleChange = (e) => setTransaction({ ...transaction, [e.target.name]: e.target.value });\r\n+    // Selected loan object\r\n+    const selectedLoan = loans.find((l) => l._id === transaction.loan);\r\n+    const remainingBalance = selectedLoan?.balance || 0;\r\n \r\n+    const handleChange = (e) => {\r\n+        const { name, value } = e.target;\r\n+        setTransaction({\r\n+            ...transaction,\r\n+            [name]: name === \"amount\" ? Number(value) : value\r\n+        });\r\n+    };\r\n+\r\n     const handleSubmit = async (e) => {\r\n         e.preventDefault();\r\n \r\n+        const amount = Number(transaction.amount);\r\n+\r\n+        // Prevent exceeding remaining balance\r\n+        if (amount > remainingBalance) {\r\n+            alert(`Amount cannot exceed remaining loan balance: ${remainingBalance}`);\r\n+            return;\r\n+        }\r\n+\r\n         const payload = {\r\n             ...transaction,\r\n-            amount: Number(transaction.amount),\r\n+            amount,\r\n             transactionDate: transaction.transactionDate ? new Date(transaction.transactionDate) : new Date()\r\n         };\r\n \r\n         try {\r\n@@ -62,8 +84,10 @@\n         <>\r\n             <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n             <div className=\"max-w-md mx-auto\">\r\n                 <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n+\r\n+                    {/* Loan selection */}\r\n                     <FormRow label=\"Loan\">\r\n                         <select\r\n                             name=\"loan\"\r\n                             value={transaction.loan}\r\n@@ -77,10 +101,16 @@\n                                     {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n                                 </option>\r\n                             ))}\r\n                         </select>\r\n+                        {selectedLoan && (\r\n+                            <p className=\"text-sm text-gray-600 mt-1\">\r\n+                                Remaining Balance: {remainingBalance}\r\n+                            </p>\r\n+                        )}\r\n                     </FormRow>\r\n \r\n+                    {/* Type */}\r\n                     <FormRow label=\"Type\">\r\n                         <select\r\n                             name=\"type\"\r\n                             value={transaction.type}\r\n@@ -94,19 +124,23 @@\n                             ))}\r\n                         </select>\r\n                     </FormRow>\r\n \r\n+                    {/* Amount */}\r\n                     <FormRow label=\"Amount\">\r\n                         <input\r\n                             type=\"number\"\r\n                             name=\"amount\"\r\n                             value={transaction.amount}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                             required\r\n+                            min=\"0\"\r\n+                            max={remainingBalance} // optional HTML restriction\r\n                         />\r\n                     </FormRow>\r\n \r\n+                    {/* Description */}\r\n                     <FormRow label=\"Description\">\r\n                         <input\r\n                             type=\"text\"\r\n                             name=\"description\"\r\n@@ -115,8 +149,9 @@\n                             className=\"w-full border p-2 rounded\"\r\n                         />\r\n                     </FormRow>\r\n \r\n+                    {/* Transaction Date */}\r\n                     <FormRow label=\"Transaction Date\">\r\n                         <input\r\n                             type=\"date\"\r\n                             name=\"transactionDate\"\r\n@@ -126,16 +161,18 @@\n                             required\r\n                         />\r\n                     </FormRow>\r\n \r\n+                    {/* Submit */}\r\n                     <div className=\"flex justify-end\">\r\n                         <button\r\n                             type=\"submit\"\r\n                             className=\"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600\"\r\n                         >\r\n                             {id ? \"Update\" : \"Create\"}\r\n                         </button>\r\n                     </div>\r\n+\r\n                 </form>\r\n             </div>\r\n \r\n             <div className=\"p-4\">\r\n"
                },
                {
                    "date": 1770584941951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -57,10 +57,10 @@\n         e.preventDefault();\r\n \r\n         const amount = Number(transaction.amount);\r\n \r\n-        // Prevent exceeding remaining balance\r\n-        if (amount > remainingBalance) {\r\n+        // Check balance only if type is \"Repayment\"\r\n+        if (transaction.type === \"Repayment\" && amount > remainingBalance) {\r\n             alert(`Amount cannot exceed remaining loan balance: ${remainingBalance}`);\r\n             return;\r\n         }\r\n \r\n@@ -101,9 +101,9 @@\n                                     {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n                                 </option>\r\n                             ))}\r\n                         </select>\r\n-                        {selectedLoan && (\r\n+                        {selectedLoan && transaction.type === \"Repayment\" && (\r\n                             <p className=\"text-sm text-gray-600 mt-1\">\r\n                                 Remaining Balance: {remainingBalance}\r\n                             </p>\r\n                         )}\r\n@@ -134,9 +134,9 @@\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                             required\r\n                             min=\"0\"\r\n-                            max={remainingBalance} // optional HTML restriction\r\n+                            max={transaction.type === \"Repayment\" ? remainingBalance : undefined} // optional\r\n                         />\r\n                     </FormRow>\r\n \r\n                     {/* Description */}\r\n"
                },
                {
                    "date": 1770697514140,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,11 @@\n import { useState, useEffect } from \"react\";\r\n import { useNavigate, useParams } from \"react-router-dom\";\r\n-import { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\n+import {\r\n+    createTransaction,\r\n+    getTransactionById,\r\n+    updateTransaction\r\n+} from \"../../api/transactionApi\";\r\n import { getLoans } from \"../../api/loanApi\";\r\n import LoanHistory from \"./LoanHistory\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n import FormRow from \"../../components/FormRow\";\r\n@@ -32,20 +36,27 @@\n                     loan: txData.loan?._id || \"\",\r\n                     type: txData.type || \"\",\r\n                     amount: txData.amount || 0,\r\n                     description: txData.description || \"\",\r\n-                    transactionDate: txData.transactionDate ? txData.transactionDate.slice(0, 10) : \"\"\r\n+                    transactionDate: txData.transactionDate\r\n+                        ? txData.transactionDate.slice(0, 10)\r\n+                        : \"\"\r\n                 });\r\n             }\r\n         };\r\n \r\n         fetchData();\r\n     }, [id]);\r\n \r\n-    // Selected loan object\r\n+    // Selected loan\r\n     const selectedLoan = loans.find((l) => l._id === transaction.loan);\r\n-    const remainingBalance = selectedLoan?.balance || 0;\r\n \r\n+    // Remaining balance (IMPORTANT: must come from backend)\r\n+    const remainingBalance =\r\n+        selectedLoan?.balance ??\r\n+        selectedLoan?.remainingBalance ??\r\n+        0;\r\n+\r\n     const handleChange = (e) => {\r\n         const { name, value } = e.target;\r\n         setTransaction({\r\n             ...transaction,\r\n@@ -57,23 +68,28 @@\n         e.preventDefault();\r\n \r\n         const amount = Number(transaction.amount);\r\n \r\n-        // Check balance only if type is \"Repayment\"\r\n+        // Validate repayment\r\n         if (transaction.type === \"Repayment\" && amount > remainingBalance) {\r\n             alert(`Amount cannot exceed remaining loan balance: ${remainingBalance}`);\r\n             return;\r\n         }\r\n \r\n         const payload = {\r\n             ...transaction,\r\n             amount,\r\n-            transactionDate: transaction.transactionDate ? new Date(transaction.transactionDate) : new Date()\r\n+            transactionDate: transaction.transactionDate\r\n+                ? new Date(transaction.transactionDate)\r\n+                : new Date()\r\n         };\r\n \r\n         try {\r\n-            if (id) await updateTransaction(id, payload);\r\n-            else await createTransaction(payload);\r\n+            if (id) {\r\n+                await updateTransaction(id, payload);\r\n+            } else {\r\n+                await createTransaction(payload);\r\n+            }\r\n             navigate(\"/transactions\");\r\n         } catch (err) {\r\n             console.error(err);\r\n             alert(\"Error saving transaction\");\r\n@@ -82,12 +98,15 @@\n \r\n     return (\r\n         <>\r\n             <PageToolbar title={id ? \"Edit Transaction\" : \"Add Transaction\"} />\r\n+\r\n             <div className=\"max-w-md mx-auto\">\r\n-                <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n-\r\n-                    {/* Loan selection */}\r\n+                <form\r\n+                    onSubmit={handleSubmit}\r\n+                    className=\"bg-white p-6 rounded shadow space-y-4\"\r\n+                >\r\n+                    {/* Loan */}\r\n                     <FormRow label=\"Loan\">\r\n                         <select\r\n                             name=\"loan\"\r\n                             value={transaction.loan}\r\n@@ -97,12 +116,15 @@\n                         >\r\n                             <option value=\"\">Select Loan</option>\r\n                             {loans.map((l) => (\r\n                                 <option key={l._id} value={l._id}>\r\n-                                    {l.borrower?.fullName ? `${l.borrower.fullName}-${l.amount}` : `Unknown-${l.amount}`}\r\n+                                    {l.borrower?.fullName\r\n+                                        ? `${l.borrower.fullName} - ${l.amount}`\r\n+                                        : `Unknown - ${l.amount}`}\r\n                                 </option>\r\n                             ))}\r\n                         </select>\r\n+\r\n                         {selectedLoan && transaction.type === \"Repayment\" && (\r\n                             <p className=\"text-sm text-gray-600 mt-1\">\r\n                                 Remaining Balance: {remainingBalance}\r\n                             </p>\r\n@@ -119,9 +141,11 @@\n                             required\r\n                         >\r\n                             <option value=\"\">Select Type</option>\r\n                             {typeOptions.map((t) => (\r\n-                                <option key={t} value={t}>{t}</option>\r\n+                                <option key={t} value={t}>\r\n+                                    {t}\r\n+                                </option>\r\n                             ))}\r\n                         </select>\r\n                     </FormRow>\r\n \r\n@@ -134,9 +158,13 @@\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                             required\r\n                             min=\"0\"\r\n-                            max={transaction.type === \"Repayment\" ? remainingBalance : undefined} // optional\r\n+                            max={\r\n+                                transaction.type === \"Repayment\"\r\n+                                    ? remainingBalance\r\n+                                    : undefined\r\n+                            }\r\n                         />\r\n                     </FormRow>\r\n \r\n                     {/* Description */}\r\n@@ -149,9 +177,9 @@\n                             className=\"w-full border p-2 rounded\"\r\n                         />\r\n                     </FormRow>\r\n \r\n-                    {/* Transaction Date */}\r\n+                    {/* Date */}\r\n                     <FormRow label=\"Transaction Date\">\r\n                         <input\r\n                             type=\"date\"\r\n                             name=\"transactionDate\"\r\n@@ -170,14 +198,38 @@\n                         >\r\n                             {id ? \"Update\" : \"Create\"}\r\n                         </button>\r\n                     </div>\r\n-\r\n                 </form>\r\n             </div>\r\n \r\n-            <div className=\"p-4\">\r\n+            {/* ===== Loan History + Balance Summary ===== */}\r\n+            <div className=\"p-4 space-y-4\">\r\n                 <LoanHistory loanId={transaction.loan} />\r\n+\r\n+                {selectedLoan && (\r\n+                    <div className=\"bg-gray-100 border rounded p-4 flex justify-between items-center\">\r\n+                        <div className=\"text-sm text-gray-600 space-y-1\">\r\n+                            <p>\r\n+                                <span className=\"font-medium\">Borrower:</span>{\" \"}\r\n+                                {selectedLoan.borrower?.fullName}\r\n+                            </p>\r\n+                            <p>\r\n+                                <span className=\"font-medium\">Loan Amount:</span>{\" \"}\r\n+                                {selectedLoan.amount}\r\n+                            </p>\r\n+                        </div>\r\n+\r\n+                        <div className=\"text-right\">\r\n+                            <p className=\"text-sm text-gray-500\">\r\n+                                Remaining Balance\r\n+                            </p>\r\n+                            <p className=\"text-xl font-bold text-gray-800\">\r\n+                                {remainingBalance}\r\n+                            </p>\r\n+                        </div>\r\n+                    </div>\r\n+                )}\r\n             </div>\r\n         </>\r\n     );\r\n };\r\n"
                },
                {
                    "date": 1770697701196,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -123,9 +123,9 @@\n                                 </option>\r\n                             ))}\r\n                         </select>\r\n \r\n-                        {selectedLoan && transaction.type === \"Repayment\" && (\r\n+                        {selectedLoan && (\r\n                             <p className=\"text-sm text-gray-600 mt-1\">\r\n                                 Remaining Balance: {remainingBalance}\r\n                             </p>\r\n                         )}\r\n"
                }
            ],
            "date": 1770566229289,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from \"react\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport { createTransaction, getTransactionById, updateTransaction } from \"../../api/transactionApi\";\r\nimport { getLoans } from \"../../api/loanApi\";\r\n\r\nconst TransactionForm = () => {\r\n    const [transaction, setTransaction] = useState({\r\n        loan: \"\",\r\n        type: \"\",\r\n        amount: \"\",\r\n        description: \"\",\r\n        transactionDate: \"\"\r\n    });\r\n\r\n    const [loans, setLoans] = useState([]);\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n\r\n    const typeOptions = [\"Repayment\", \"Late Fee\", \"Penalty\"];\r\n\r\n    useEffect(() => {\r\n        // Fetch loans for dropdown\r\n        getLoans().then(setLoans);\r\n\r\n        // If editing, fetch transaction by ID\r\n        if (id) {\r\n            getTransactionById(id).then((data) => {\r\n                setTransaction({\r\n                    loan: data.loan?._id || \"\",\r\n                    type: data.type || \"\",\r\n                    amount: data.amount || \"\",\r\n                    description: data.description || \"\",\r\n                    transactionDate: data.transactionDate ? data.transactionDate.slice(0, 10) : \"\"\r\n                });\r\n            });\r\n        }\r\n    }, [id]);\r\n\r\n    const handleChange = (e) => setTransaction({ ...transaction, [e.target.name]: e.target.value });\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n\r\n        const payload = {\r\n            ...transaction,\r\n            amount: Number(transaction.amount),\r\n            transactionDate: transaction.transactionDate ? new Date(transaction.transactionDate) : new Date()\r\n        };\r\n\r\n        try {\r\n            if (id) await updateTransaction(id, payload);\r\n            else await createTransaction(payload);\r\n            navigate(\"/transactions\");\r\n        } catch (err) {\r\n            console.error(err);\r\n            alert(\"Error saving transaction\");\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"max-w-md mx-auto\">\r\n            <h1 className=\"text-2xl font-bold mb-4\">{id ? \"Edit\" : \"Add\"} Transaction</h1>\r\n            <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow space-y-4\">\r\n\r\n                {/* Loan */}\r\n                <div className=\"flex flex-col\">\r\n                    <label className=\"mb-1 font-medium\">Loan</label>\r\n                    <select\r\n                        name=\"loan\"\r\n                        value={transaction.loan}\r\n                        onChange={handleChange}\r\n                        className=\"w-full border p-2 rounded\"\r\n                    >\r\n                        <option value=\"\">Select Loan</option>\r\n                        {loans.map((l) => (\r\n                            <option key={l._id} value={l._id}>\r\n                                {l._id} - {l.borrower?.fullName || \"Unknown\"} - ${l.amount}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n\r\n                {/* Transaction Type */}\r\n                <div className=\"flex flex-col\">\r\n                    <label className=\"mb-1 font-medium\">Type</label>\r\n                    <select\r\n                        name=\"type\"\r\n                        value={transaction.type}\r\n                        onChange={handleChange}\r\n                        className=\"w-full border p-2 rounded\"\r\n                    >\r\n                        <option value=\"\">Select Type</option>\r\n                        {typeOptions.map((t) => (\r\n                            <option key={t} value={t}>{t}</option>\r\n                        ))}\r\n                    </select>\r\n                </div>\r\n\r\n                {/* Amount */}\r\n                <div className=\"flex flex-col\">\r\n                    <label className=\"mb-1 font-medium\">Amount</label>\r\n                    <input\r\n                        type=\"number\"\r\n                        name=\"amount\"\r\n                        value={transaction.amount}\r\n                        onChange={handleChange}\r\n                        className=\"w-full border p-2 rounded\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Description */}\r\n                <div className=\"flex flex-col\">\r\n                    <label className=\"mb-1 font-medium\">Description</label>\r\n                    <input\r\n                        type=\"text\"\r\n                        name=\"description\"\r\n                        value={transaction.description}\r\n                        onChange={handleChange}\r\n                        className=\"w-full border p-2 rounded\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Transaction Date */}\r\n                <div className=\"flex flex-col\">\r\n                    <label className=\"mb-1 font-medium\">Transaction Date</label>\r\n                    <input\r\n                        type=\"date\"\r\n                        name=\"transactionDate\"\r\n                        value={transaction.transactionDate}\r\n                        onChange={handleChange}\r\n                        className=\"w-full border p-2 rounded\"\r\n                    />\r\n                </div>\r\n\r\n                {/* Submit Button */}\r\n                <div className=\"flex justify-end\">\r\n                    <button\r\n                        type=\"submit\"\r\n                        className=\"bg-gray-500 text-white px-6 py-2 rounded hover:bg-gray-600\"\r\n                    >\r\n                        {id ? \"Update\" : \"Create\"}\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default TransactionForm;\r\n"
        }
    ]
}