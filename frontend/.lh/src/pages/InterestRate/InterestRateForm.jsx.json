{
    "sourceFile": "src/pages/InterestRate/InterestRateForm.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 5,
            "patches": [
                {
                    "date": 1770698761492,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1770698964251,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n import { useState, useEffect } from \"react\";\r\n import { useNavigate, useParams } from \"react-router-dom\";\r\n-import { createInterestRate, updateInterestRate } from \"../../api/interestRateApi\";\r\n+import { createInterestRate, updateInterestRate, getInterestRateById } from \"../../api/interestRateApi\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n import FormRow from \"../../components/FormRow\";\r\n \r\n const InterestRateForm = () => {\r\n"
                },
                {
                    "date": 1770699137467,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -33,9 +33,9 @@\n                     <FormRow label=\"Interest Rate\">\r\n                         <input\r\n                             type=\"number\"\r\n                             name=\"rate\"\r\n-                            value={borrower.rate}\r\n+                            value={interestRate.rate}\r\n                             onChange={handleChange}\r\n                             className=\"w-full border p-2 rounded\"\r\n                             required\r\n                         />\r\n"
                },
                {
                    "date": 1770699573600,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,20 @@\n import { useState, useEffect } from \"react\";\r\n import { useNavigate, useParams } from \"react-router-dom\";\r\n-import { createInterestRate, updateInterestRate, getInterestRateById } from \"../../api/interestRateApi\";\r\n+import {\r\n+    createInterestRate,\r\n+    updateInterestRate,\r\n+    getInterestRateById,\r\n+    checkInterestRateExists\r\n+} from \"../../api/interestRateApi\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n import FormRow from \"../../components/FormRow\";\r\n \r\n const InterestRateForm = () => {\r\n-    const [interestRate, setInterestRate] = useState({ rate: 0 });\r\n+    const [interestRate, setInterestRate] = useState({ rate: \"\" });\r\n+    const [error, setError] = useState(\"\");\r\n+    const [checking, setChecking] = useState(false);\r\n+\r\n     const navigate = useNavigate();\r\n     const { id } = useParams();\r\n \r\n     useEffect(() => {\r\n@@ -14,20 +22,43 @@\n             getInterestRateById(id).then(setInterestRate);\r\n         }\r\n     }, [id]);\r\n \r\n-    const handleChange = (e) => setInterestRate({ ...interestRate, [e.target.name]: e.target.value });\r\n+    const handleChange = (e) => {\r\n+        setInterestRate({ ...interestRate, [e.target.name]: e.target.value });\r\n+        setError(\"\"); // clear error on change\r\n+    };\r\n \r\n     const handleSubmit = async (e) => {\r\n         e.preventDefault();\r\n-        if (id) await updateInterestRate(id, interestRate);\r\n-        else await createInterestRate(interestRate);\r\n+\r\n+        setChecking(true);\r\n+\r\n+        const exists = await checkInterestRateExists(\r\n+            interestRate.rate,\r\n+            id // exclude current record when editing\r\n+        );\r\n+\r\n+        setChecking(false);\r\n+\r\n+        if (exists) {\r\n+            setError(\"This interest rate already exists.\");\r\n+            return;\r\n+        }\r\n+\r\n+        if (id) {\r\n+            await updateInterestRate(id, interestRate);\r\n+        } else {\r\n+            await createInterestRate(interestRate);\r\n+        }\r\n+\r\n         navigate(\"/interestRates\");\r\n     };\r\n \r\n     return (\r\n         <>\r\n             <PageToolbar title={id ? \"Edit Interest Rate\" : \"Add Interest Rate\"} />\r\n+\r\n             <div className=\"max-w-md mx-auto\">\r\n                 <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow\">\r\n \r\n                     <FormRow label=\"Interest Rate\">\r\n@@ -35,19 +66,26 @@\n                             type=\"number\"\r\n                             name=\"rate\"\r\n                             value={interestRate.rate}\r\n                             onChange={handleChange}\r\n-                            className=\"w-full border p-2 rounded\"\r\n+                            className={`w-full border p-2 rounded ${error ? \"border-red-500\" : \"\"\r\n+                                }`}\r\n                             required\r\n                         />\r\n+                        {error && (\r\n+                            <p className=\"text-sm text-red-500 mt-1\">\r\n+                                {error}\r\n+                            </p>\r\n+                        )}\r\n                     </FormRow>\r\n \r\n                     <div className=\"flex justify-end\">\r\n                         <button\r\n                             type=\"submit\"\r\n-                            className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\r\n+                            disabled={checking}\r\n+                            className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 disabled:opacity-50\"\r\n                         >\r\n-                            {id ? \"Update\" : \"Create\"}\r\n+                            {checking ? \"Checking...\" : id ? \"Update\" : \"Create\"}\r\n                         </button>\r\n                     </div>\r\n                 </form>\r\n             </div>\r\n"
                },
                {
                    "date": 1770699780990,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,8 +11,9 @@\n \r\n const InterestRateForm = () => {\r\n     const [interestRate, setInterestRate] = useState({ rate: \"\" });\r\n     const [error, setError] = useState(\"\");\r\n+    const [isValid, setIsValid] = useState(true);\r\n     const [checking, setChecking] = useState(false);\r\n \r\n     const navigate = useNavigate();\r\n     const { id } = useParams();\r\n@@ -23,29 +24,41 @@\n         }\r\n     }, [id]);\r\n \r\n     const handleChange = (e) => {\r\n-        setInterestRate({ ...interestRate, [e.target.name]: e.target.value });\r\n-        setError(\"\"); // clear error on change\r\n+        setInterestRate({ ...interestRate, rate: e.target.value });\r\n+        setError(\"\");\r\n+        setIsValid(true);\r\n     };\r\n \r\n-    const handleSubmit = async (e) => {\r\n-        e.preventDefault();\r\n+    // ğŸ”¥ PRE-SUBMIT VALIDATION\r\n+    const validateRate = async () => {\r\n+        if (!interestRate.rate) return;\r\n \r\n         setChecking(true);\r\n \r\n         const exists = await checkInterestRateExists(\r\n             interestRate.rate,\r\n-            id // exclude current record when editing\r\n+            id\r\n         );\r\n \r\n         setChecking(false);\r\n \r\n         if (exists) {\r\n             setError(\"This interest rate already exists.\");\r\n-            return;\r\n+            setIsValid(false);\r\n+        } else {\r\n+            setError(\"\");\r\n+            setIsValid(true);\r\n         }\r\n+    };\r\n \r\n+    const handleSubmit = async (e) => {\r\n+        e.preventDefault();\r\n+\r\n+        // âŒ Block submit if invalid\r\n+        if (!isValid) return;\r\n+\r\n         if (id) {\r\n             await updateInterestRate(id, interestRate);\r\n         } else {\r\n             await createInterestRate(interestRate);\r\n@@ -66,12 +79,20 @@\n                             type=\"number\"\r\n                             name=\"rate\"\r\n                             value={interestRate.rate}\r\n                             onChange={handleChange}\r\n+                            onBlur={validateRate}   // âœ… validate BEFORE submit\r\n                             className={`w-full border p-2 rounded ${error ? \"border-red-500\" : \"\"\r\n                                 }`}\r\n                             required\r\n                         />\r\n+\r\n+                        {checking && (\r\n+                            <p className=\"text-sm text-gray-400 mt-1\">\r\n+                                Checking availabilityâ€¦\r\n+                            </p>\r\n+                        )}\r\n+\r\n                         {error && (\r\n                             <p className=\"text-sm text-red-500 mt-1\">\r\n                                 {error}\r\n                             </p>\r\n@@ -80,12 +101,12 @@\n \r\n                     <div className=\"flex justify-end\">\r\n                         <button\r\n                             type=\"submit\"\r\n-                            disabled={checking}\r\n+                            disabled={!isValid || checking}\r\n                             className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 disabled:opacity-50\"\r\n                         >\r\n-                            {checking ? \"Checking...\" : id ? \"Update\" : \"Create\"}\r\n+                            {id ? \"Update\" : \"Create\"}\r\n                         </button>\r\n                     </div>\r\n                 </form>\r\n             </div>\r\n"
                },
                {
                    "date": 1770699974845,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,61 +3,53 @@\n import {\r\n     createInterestRate,\r\n     updateInterestRate,\r\n     getInterestRateById,\r\n-    checkInterestRateExists\r\n+    getInterestRates   // ğŸ‘ˆ get all rates\r\n } from \"../../api/interestRateApi\";\r\n import PageToolbar from \"../../components/PageToolbar\";\r\n import FormRow from \"../../components/FormRow\";\r\n \r\n const InterestRateForm = () => {\r\n     const [interestRate, setInterestRate] = useState({ rate: \"\" });\r\n+    const [allRates, setAllRates] = useState([]);\r\n     const [error, setError] = useState(\"\");\r\n-    const [isValid, setIsValid] = useState(true);\r\n-    const [checking, setChecking] = useState(false);\r\n \r\n     const navigate = useNavigate();\r\n     const { id } = useParams();\r\n \r\n+    // ğŸ”¹ load all rates (ONCE)\r\n     useEffect(() => {\r\n+        getInterestRates().then(setAllRates);\r\n+    }, []);\r\n+\r\n+    // ğŸ”¹ load edit data\r\n+    useEffect(() => {\r\n         if (id) {\r\n             getInterestRateById(id).then(setInterestRate);\r\n         }\r\n     }, [id]);\r\n \r\n     const handleChange = (e) => {\r\n-        setInterestRate({ ...interestRate, rate: e.target.value });\r\n+        setInterestRate({ rate: e.target.value });\r\n         setError(\"\");\r\n-        setIsValid(true);\r\n     };\r\n \r\n-    // ğŸ”¥ PRE-SUBMIT VALIDATION\r\n-    const validateRate = async () => {\r\n-        if (!interestRate.rate) return;\r\n-\r\n-        setChecking(true);\r\n-\r\n-        const exists = await checkInterestRateExists(\r\n-            interestRate.rate,\r\n-            id\r\n+    // ğŸ”¥ FRONTEND UNIQUE CHECK\r\n+    const isDuplicateRate = () => {\r\n+        return allRates.some(r =>\r\n+            Number(r.rate) === Number(interestRate.rate) &&\r\n+            r._id !== id // exclude self when editing\r\n         );\r\n-\r\n-        setChecking(false);\r\n-\r\n-        if (exists) {\r\n-            setError(\"This interest rate already exists.\");\r\n-            setIsValid(false);\r\n-        } else {\r\n-            setError(\"\");\r\n-            setIsValid(true);\r\n-        }\r\n     };\r\n \r\n     const handleSubmit = async (e) => {\r\n         e.preventDefault();\r\n \r\n-        // âŒ Block submit if invalid\r\n-        if (!isValid) return;\r\n+        if (isDuplicateRate()) {\r\n+            setError(\"This interest rate already exists.\");\r\n+            return; // âŒ block submit\r\n+        }\r\n \r\n         if (id) {\r\n             await updateInterestRate(id, interestRate);\r\n         } else {\r\n@@ -79,20 +71,13 @@\n                             type=\"number\"\r\n                             name=\"rate\"\r\n                             value={interestRate.rate}\r\n                             onChange={handleChange}\r\n-                            onBlur={validateRate}   // âœ… validate BEFORE submit\r\n                             className={`w-full border p-2 rounded ${error ? \"border-red-500\" : \"\"\r\n                                 }`}\r\n                             required\r\n                         />\r\n \r\n-                        {checking && (\r\n-                            <p className=\"text-sm text-gray-400 mt-1\">\r\n-                                Checking availabilityâ€¦\r\n-                            </p>\r\n-                        )}\r\n-\r\n                         {error && (\r\n                             <p className=\"text-sm text-red-500 mt-1\">\r\n                                 {error}\r\n                             </p>\r\n@@ -101,10 +86,9 @@\n \r\n                     <div className=\"flex justify-end\">\r\n                         <button\r\n                             type=\"submit\"\r\n-                            disabled={!isValid || checking}\r\n-                            className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 disabled:opacity-50\"\r\n+                            className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\r\n                         >\r\n                             {id ? \"Update\" : \"Create\"}\r\n                         </button>\r\n                     </div>\r\n"
                }
            ],
            "date": 1770698761492,
            "name": "Commit-0",
            "content": "import { useState, useEffect } from \"react\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport { createInterestRate, updateInterestRate } from \"../../api/interestRateApi\";\r\nimport PageToolbar from \"../../components/PageToolbar\";\r\nimport FormRow from \"../../components/FormRow\";\r\n\r\nconst InterestRateForm = () => {\r\n    const [interestRate, setInterestRate] = useState({ rate: 0 });\r\n    const navigate = useNavigate();\r\n    const { id } = useParams();\r\n\r\n    useEffect(() => {\r\n        if (id) {\r\n            getInterestRateById(id).then(setInterestRate);\r\n        }\r\n    }, [id]);\r\n\r\n    const handleChange = (e) => setInterestRate({ ...interestRate, [e.target.name]: e.target.value });\r\n\r\n    const handleSubmit = async (e) => {\r\n        e.preventDefault();\r\n        if (id) await updateInterestRate(id, interestRate);\r\n        else await createInterestRate(interestRate);\r\n        navigate(\"/interestRates\");\r\n    };\r\n\r\n    return (\r\n        <>\r\n            <PageToolbar title={id ? \"Edit Interest Rate\" : \"Add Interest Rate\"} />\r\n            <div className=\"max-w-md mx-auto\">\r\n                <form onSubmit={handleSubmit} className=\"bg-white p-6 rounded shadow\">\r\n\r\n                    <FormRow label=\"Interest Rate\">\r\n                        <input\r\n                            type=\"number\"\r\n                            name=\"rate\"\r\n                            value={borrower.rate}\r\n                            onChange={handleChange}\r\n                            className=\"w-full border p-2 rounded\"\r\n                            required\r\n                        />\r\n                    </FormRow>\r\n\r\n                    <div className=\"flex justify-end\">\r\n                        <button\r\n                            type=\"submit\"\r\n                            className=\"bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600\"\r\n                        >\r\n                            {id ? \"Update\" : \"Create\"}\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </>\r\n    );\r\n};\r\n\r\nexport default InterestRateForm;\r\n"
        }
    ]
}